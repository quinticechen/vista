
# Sequence Diagrams

This document contains sequence diagrams that illustrate the key flows and interactions within the Vista platform.

## Authentication & Admin Redirect Flow

```
┌────────┐          ┌─────────────┐          ┌─────────┐          ┌─────────────┐
│  User  │          │ Auth Page   │          │Supabase │          │ Admin       │
│        │          │             │          │  Auth   │          │ Dashboard   │
└───┬────┘          └──────┬──────┘          └────┬────┘          └──────┬──────┘
    │                      │                      │                      │
    │  Visit Auth Page     │                      │                      │
    │─────────────────────>│                      │                      │
    │                      │                      │                      │
    │                      │   Login Request      │                      │
    │                      │─────────────────────>│                      │
    │                      │                      │                      │
    │                      │  Auth Token Response │                      │
    │                      │<─────────────────────│                      │
    │                      │                      │                      │
    │                      │ Auto Redirect to Admin                      │
    │                      │─────────────────────────────────────────────>│
    │                      │                      │                      │
    │                      │                      │                      │
    │  Welcome & Onboarding│                      │                      │
    │<─────────────────────────────────────────────────────────────────────│
    │                      │                      │                      │
┌───┴────┐          ┌──────┴──────┐          ┌────┴────┐          ┌──────┴──────┐
│  User  │          │ Auth Page   │          │Supabase │          │ Admin       │
│        │          │             │          │  Auth   │          │ Dashboard   │
└────────┘          └─────────────┘          └─────────┘          └─────────────┘
```

## User Onboarding Flow

```
┌────────┐          ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│  User  │          │ Admin       │          │ Onboarding  │          │  Setup      │
│        │          │ Dashboard   │          │  Component  │          │   Pages     │
└───┬────┘          └──────┬──────┘          └──────┬──────┘          └──────┬──────┘
    │                      │                        │                        │
    │ View Dashboard       │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Check Completion      │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Show Progress         │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │  View Progress       │                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
    │  Click Setup Step    │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Navigate to Setup     │                        │
    │                      │───────────────────────────────────────────────>│
    │                      │                        │                        │
    │                      │                        │                        │
    │  Complete Setup      │                        │                        │
    │<───────────────────────────────────────────────────────────────────────│
    │                      │                        │                        │
    │  Return to Dashboard │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Update Progress       │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │  Show Updated Status │                        │                        │
    │<─────────────────────────────────────────────│                        │
    │                      │                        │                        │
┌───┴────┐          ┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│  User  │          │ Admin       │          │ Onboarding  │          │  Setup      │
│        │          │ Dashboard   │          │  Component  │          │   Pages     │
└────────┘          └─────────────┘          └─────────────┘          └─────────────┘
```

## Content Search Flow

```
┌────────┐          ┌─────────────┐          ┌─────────┐          ┌─────────────┐
│  User  │          │ Index Page  │          │ Vista   │          │ Content     │
│        │          │ (Search)    │          │  Page   │          │ Detail Page │
└───┬────┘          └──────┬──────┘          └────┬────┘          └──────┬──────┘
    │                      │                      │                      │
    │  Enter Purpose       │                      │                      │
    │─────────────────────>│                      │                      │
    │                      │                      │                      │
    │                      │  Navigate with Query │                      │
    │                      │─────────────────────>│                      │
    │                      │                      │                      │
    │                      │                      │  Fetch Results       │
    │                      │                      │────────────────┐     │
    │                      │                      │                │     │
    │                      │                      │<───────────────┘     │
    │                      │                      │                      │
    │  Display Results     │                      │                      │
    │<─────────────────────────────────────────────                      │
    │                      │                      │                      │
    │  Select Content Item │                      │                      │
    │─────────────────────────────────────────────>                      │
    │                      │                      │                      │
    │                      │                      │  Navigate to Detail  │
    │                      │                      │─────────────────────>│
    │                      │                      │                      │
    │                      │                      │                      │
    │  Display Content Detail                                            │
    │<───────────────────────────────────────────────────────────────────│
    │                      │                      │                      │
┌───┴────┐          ┌──────┴──────┐          ┌────┴────┐          ┌──────┴──────┐
│  User  │          │ Index Page  │          │ Vista   │          │ Content     │
│        │          │ (Search)    │          │  Page   │          │ Detail Page │
└────────┘          └─────────────┘          └─────────┘          └─────────────┘
```

## Embedding Process Flow

```
┌────────┐          ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│  Admin │          │ Admin Page  │          │ Embedding   │          │ Content     │
│  User  │          │             │          │   Service   │          │   Items     │
└───┬────┘          └──────┬──────┘          └──────┬──────┘          └──────┬──────┘
    │                      │                        │                        │
    │ Start Embedding      │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Create Job            │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Job Created           │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │                      │  Start Process         │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Process Started       │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │                      │                        │  Get Content Items     │
    │                      │                        │───────────────────────>│
    │                      │                        │                        │
    │                      │                        │  Return Content        │
    │                      │                        │<───────────────────────│
    │                      │                        │                        │
    │                      │                        │  Generate Embeddings   │
    │                      │                        │─────────────────┐      │
    │                      │                        │                 │      │
    │                      │                        │<────────────────┘      │
    │                      │                        │                        │
    │                      │                        │  Store Embeddings      │
    │                      │                        │───────────────────────>│
    │                      │                        │                        │
    │                      │                        │  Embeddings Stored     │
    │                      │                        │<───────────────────────│
    │                      │                        │                        │
    │                      │  Job Complete          │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │  Show Success        │                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
┌───┴────┐          ┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│  Admin │          │ Admin Page  │          │ Embedding   │          │ Content     │
│  User  │          │             │          │   Service   │          │   Items     │
└────────┘          └─────────────┘          └─────────────┘          └─────────────┘
```

## URL Parameter Page Flow

```
┌────────┐          ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│  User  │          │ URL Param   │          │ Profile     │          │ Content     │
│        │          │   Route     │          │   Service   │          │   Items     │
└───┬────┘          └──────┬──────┘          └──────┬──────┘          └──────┬──────┘
    │                      │                        │                        │
    │ Visit /:urlParam     │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Get Profile           │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Return Profile        │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │                      │  Get Content           │                        │
    │                      │───────────────────────────────────────────────>│
    │                      │                        │                        │
    │                      │  Return Content        │                        │
    │                      │<───────────────────────────────────────────────│
    │                      │                        │                        │
    │  Display Custom Page │                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
    │  Search Content      │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Get User Content      │                        │
    │                      │───────────────────────────────────────────────>│
    │                      │                        │                        │
    │                      │  Return Results        │                        │
    │                      │<───────────────────────────────────────────────│
    │                      │                        │                        │
    │  Display Results     │                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
┌───┴────┐          ┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│  User  │          │ URL Param   │          │ Profile     │          │ Content     │
│        │          │   Route     │          │   Service   │          │   Items     │
└────────┘          └─────────────┘          └─────────────┘          └─────────────┘
```

## Home Page Customization Flow

```
┌────────┐          ┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│  Admin │          │ HomePage    │          │ HomePage    │          │ Index       │
│  User  │          │   Admin     │          │   Service   │          │   Page      │
└───┬────┘          └──────┬──────┘          └──────┬──────┘          └──────┬──────┘
    │                      │                        │                        │
    │ Visit Admin/HomePage │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Get Settings          │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Return Settings       │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │  Display Settings Form                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
    │  Update Settings     │                        │                        │
    │─────────────────────>│                        │                        │
    │                      │                        │                        │
    │                      │  Save Settings         │                        │
    │                      │───────────────────────>│                        │
    │                      │                        │                        │
    │                      │  Settings Saved        │                        │
    │                      │<───────────────────────│                        │
    │                      │                        │                        │
    │  Show Success        │                        │                        │
    │<─────────────────────│                        │                        │
    │                      │                        │                        │
    │  Visit /:urlParam    │                        │                        │
    │───────────────────────────────────────────────────────────────────────>│
    │                      │                        │                        │
    │                      │                        │  Get Settings          │
    │                      │                        │<────────────────┐      │
    │                      │                        │                 │      │
    │                      │                        │  Return Settings│      │
    │                      │                        │─────────────────┘      │
    │                      │                        │                        │
    │  Display Custom Home │                        │                        │
    │<───────────────────────────────────────────────────────────────────────│
    │                      │                        │                        │
┌───┴────┐          ┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│  Admin │          │ HomePage    │          │ HomePage    │          │ Index       │
│  User  │          │   Admin     │          │   Service   │          │   Page      │
└────────┘          └─────────────┘          └─────────────┘          └─────────────┘
```

## Notion Webhook Processing Flow

```
┌─────────┐        ┌──────────────┐        ┌─────────────┐        ┌────────────┐
│ Notion  │        │ Edge Function │        │ Webhook     │        │ Content    │
│ API     │        │               │        │ Verification│        │ Processing │
└────┬────┘        └───────┬──────┘        └──────┬──────┘        └──────┬─────┘
     │                     │                      │                      │
     │  Webhook Event      │                      │                      │
     │────────────────────>│                      │                      │
     │                     │                      │                      │
     │                     │  Verify Signature    │                      │
     │                     │─────────────────────>│                      │
     │                     │                      │                      │
     │                     │  Signature Valid     │                      │
     │                     │<─────────────────────│                      │
     │                     │                      │                      │
     │                     │  Process Content     │                      │
     │                     │─────────────────────────────────────────────>
     │                     │                      │                      │
     │                     │                      │                      │
     │                     │  Fetch Content       │                      │
     │<────────────────────────────────────────────────────────────────────
     │                     │                      │                      │
     │  Return Content     │                      │                      │
     │────────────────────────────────────────────────────────────────────>
     │                     │                      │                      │
     │                     │                      │                      │
     │                     │                      │                      │
     │                     │  Content Processed   │                      │
     │                     │<─────────────────────────────────────────────
     │                     │                      │                      │
     │                     │                      │                      │
┌────┴────┐        ┌───────┴──────┐        ┌──────┴──────┐        ┌──────┴─────┐
│ Notion  │        │ Edge Function │        │ Webhook     │        │ Content    │
│ API     │        │               │        │ Verification│        │ Processing │
└─────────┘        └──────────────┘        └─────────────┘        └────────────┘
```

These sequence diagrams illustrate the major interaction flows within the Vista platform. As new features are added, corresponding diagrams will be created to document their behavior.
